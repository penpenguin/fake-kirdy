# 要件定義書

## はじめに

Webベースのパロディゲームを開発します。  
主人公はKirdyという名前で、ゲームの核となる要素（敵能力利用、迷宮探索、複数エリア）を含みながら、Web技術を活用した独自の体験を提供します。

## 要件

### 要件 1: 基本的なゲームプレイ

**ユーザーストーリー:** プレイヤーとして、Kirdyを操作して2Dプラットフォーマーゲームを楽しみたい。基本的な移動、ジャンプ、ホバリング、引き寄せができるようにしたい。

#### 受入基準

1. WHEN プレイヤーが矢印キーまたはWASDキーを押す THEN Kirdyが対応する方向に移動する SHALL
2. WHEN プレイヤーがスペースキーを押す THEN Kirdyがジャンプする SHALL
3. WHEN プレイヤーがスペースキーを長押しする THEN Kirdyがホバリング状態になり空中に浮遊する SHALL
4. WHEN プレイヤーが引き寄せキー（Cキー）を押す THEN Kirdyが前方の敵や物体を引き寄せる SHALL
5. WHEN Kirdyが敵に触れる THEN 適切な衝突判定が発生する SHALL

### 要件 2: 敵能力利用システム

**ユーザーストーリー:** プレイヤーとして、引き寄せた敵の力を一時的に借りて異なる攻撃方法や移動方法を使用したい。

#### 受入基準

1. WHEN Kirdyが引き寄せキー（Cキー）を押したまま THEN 引き寄せフィールドが維持され、一定距離以内の敵をKirdyの前方に固定する SHALL
2. WHEN 敵が引き寄せ状態でプレイヤーが同期キー（下矢印またはSキー）を押す THEN Kirdyが敵能力をチャネルして現在の能力として装備する SHALL
3. WHEN 敵能力が同期された状態でプレイヤーが敵能力発動キー（Zキー）を押す THEN 敵能力に応じた特殊攻撃または移動効果が実行される SHALL
4. WHEN プレイヤーが解除キー（Xキー）を押す THEN 敵能力とのリンクが解除され、Kirdyが基本状態に戻る SHALL
5. IF Kirdyが別の敵を引き寄せて同期しようとする AND 既に能力を装備している THEN 現在の能力が新しい敵の能力に置き換わる SHALL
6. IF 引き寄せ状態の敵が倒された THEN Kirdyの能力リンクが自動で解除され基本状態に戻る SHALL

### 要件 3: 迷宮探索システム

**ユーザーストーリー:** プレイヤーとして、複数のエリアからなる迷宮を探索し、隠されたアイテムや秘密の通路を発見したい。

#### 受入基準

1. WHEN プレイヤーがエリアの境界に到達する THEN 隣接するエリアに移動できる SHALL
2. WHEN Kirdyが特定の場所に到達する THEN 隠されたアイテムや通路が発見される SHALL
3. WHEN プレイヤーがマップキー（Mキー）を押す THEN 現在の探索状況を示すマップが表示される SHALL
4. IF エリアに未発見の要素がある THEN マップ上で視覚的に区別される SHALL
5. WHEN プレイヤーが Forest / Ice / Fire / Ruins の各 Expanse 最終ノードへ到達する THEN 固定リリクアリエリアへ遷移し、対応する Keystone を入手するまで他クラスタへ抜けられない SHALL

### 要件 4: 敵キャラクターシステム

**ユーザーストーリー:** プレイヤーとして、様々な行動パターンを持つ敵キャラクターと戦い、ゲームに挑戦性を感じたい。ただし、Kirdyが囲まれて困らないよう、適度な難易度を保ちたい。

#### 受入基準

1. WHEN 敵がKirdyを発見する THEN 敵がKirdyに向かって移動または攻撃する SHALL
2. WHEN Kirdyが敵に攻撃を当てる THEN 敵のHPが減少する SHALL
3. WHEN 敵のHPが0になる THEN 敵が倒され、敵能力利用の機会が提供される SHALL
4. WHEN 画面内の敵の数が3体以上になる THEN 新しい敵の出現を制限する SHALL
5. WHEN Kirdyの周囲に敵が2体以上近づく THEN 他の敵は一定距離を保つ SHALL
6. IF 敵が特殊能力を持つ THEN その能力に応じた独特な行動パターンを示す SHALL

### 要件 5: ユーザーインターフェース

**ユーザーストーリー:** プレイヤーとして、現在のHP、能力、スコアなどの重要な情報を常に確認できるようにしたい。

#### 受入基準

1. WHEN ゲームが開始される THEN HPバー、現在の能力、スコアが画面に表示される SHALL
2. WHEN Kirdyの状態が変化する THEN UIが即座に更新される SHALL
3. WHEN ゲームが一時停止される THEN ポーズメニューが表示される SHALL
4. IF プレイヤーがゲームオーバーになる THEN リスタートオプションが提供される SHALL

### 要件 6: Web技術最適化

**ユーザーストーリー:** プレイヤーとして、様々なデバイスでスムーズにゲームを楽しみたい。

#### 受入基準

1. WHEN ゲームがWebブラウザで読み込まれる THEN 60FPSで動作する SHALL
2. WHEN プレイヤーがモバイルデバイスでアクセスする THEN タッチコントロールが利用可能になる SHALL
3. WHEN ゲームデータが変更される THEN ローカルストレージに進行状況が保存される SHALL
4. IF ブラウザがWebGLをサポートしていない THEN Canvas 2Dにフォールバックする SHALL
